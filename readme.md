# Salesforce to HubSpot Data Migration Scripts

This project contains a collection of Node.js scripts designed to process a data export from Salesforce and prepare it for migration into HubSpot. The scripts handle file renaming, generating import sheets for notes and engagements, and uploading files to HubSpot via its API.

---
## Prerequisites

Before you begin, ensure you have the following:

1.  **Node.js:** Make sure Node.js and npm are installed on your machine.
2.  **Salesforce Data Export:** You need a complete data export from Salesforce, including:
    * `Attachment.csv`
    * `ContentVersion.csv`
    * `ContentDocumentLink.csv`
    * `Note.csv` (for classic notes)
    * `Events.csv`
    * `Opportunity.csv`
    * Folders containing the actual exported files (e.g., `Attachments`, `ContentVersion`).
3.  **HubSpot ID Mappers:** After importing your main records (Contacts, Companies, Deals) into HubSpot, you must create a set of mapping CSVs that link the old Salesforce IDs to the new HubSpot IDs.
4.  **Dependencies:** In your terminal, navigate to the project folder and run the following command to install all necessary libraries:
    ```bash
    npm install axios csv-parser dotenv file-type form-data mime-types
    ```

---
## The Migration Workflow

The migration process should be performed in the following order. Each step uses one or more scripts from this project.

➡️ **Step 1: File Preparation (Renaming)**
Organize your raw exported files into a consistent, readable format.
* `attachment-renamer.js`
* `contentVersion-renamer.js`

➡️ **Step 2: Generate Raw Import Sheets**
Create the initial CSV files for notes and engagements. These will still contain Salesforce IDs.
* `create-snotes.js` (for modern SNotes)
* `create-classic-notes.js`
* `create-activities.js`

➡️ **Step 3: Map Salesforce IDs to HubSpot IDs**
This is a manual step where you import your main records (Contacts, Companies, etc.) into HubSpot. Then, you create the `mapper` CSVs that link the old Salesforce IDs to the new HubSpot IDs.

➡️ **Step 4: Finalize Import Sheets**
Run `map-snotes.js` to replace the SF IDs in your note sheets with the correct HubSpot IDs.

➡️ **Step 5: Prepare File Upload Manifest**
Run `create-import-manifest.js` to generate the JSON files that list which files belong to which HubSpot records.

➡️ **Step 6: Upload Files to HubSpot**
Run `import-files.js` to read the manifest and upload/attach all files via the API.

---
## Script Details & Usage

### 1. File Renaming Scripts

These scripts make your file folders manageable by renaming files from their Salesforce ID to a more descriptive format (`ID -- Title.ext`).

#### `attachment-renamer.js`
* **Purpose:** Renames files from your `Attachment.csv` export.
* **Configuration:** Set the `CSV_FILE_PATH` and `FILES_DIRECTORY_PATH` variables inside the script.
* **Usage:** `node attachment-renamer.js`

#### `contentVersion-renamer.js`
* **Purpose:** Renames files from your `ContentVersion.csv` export. It correctly handles versioning (only processing the latest), skips SNotes, and truncates filenames that are too long.
* **Configuration:** Set the `CONTENT_VERSION_CSV` and `FILES_DIRECTORY_PATH` variables. You can also adjust `MAX_FILENAME_BODY_LENGTH`.
* **Usage:** `node contentVersion-renamer.js`

### 2. Import Sheet Generators

These scripts read your Salesforce data and create the initial CSV files for import.

#### `create-snotes.js`
* **Purpose:** Processes `ContentVersion.csv` to find all SNotes (rich text notes), reads their HTML content, and generates categorized import sheets (`..._Contacts.csv`, `..._Companies.csv`, etc.).
* **Configuration:** Set paths for `ContentVersion.csv`, `ContentDocumentLink.csv`, and the folder containing the files. The `sfIdPrefixMap` can also be customized.
* **Usage:** `node create-snotes.js`

#### `create-classic-notes.js`
* **Purpose:** Processes the classic `Note.csv` export and generates categorized import sheets. It combines the `Title` and `Body` fields for better context in HubSpot.
* **Configuration:** Set the path for `Note.csv` and the mappers directory.
* **Usage:** `node create-classic-notes.js`

#### `create-activities.js`
* **Purpose:** Processes `Events.csv` to create import sheets for Calls, Meetings, and Emails.
* **Configuration:** The `TYPE_MAP` object at the top is crucial. Here, you map your custom Salesforce event types (e.g., "Qual Call", "Demo") to a standard HubSpot type (`calls`, `meetings`, `emails`).
* **Usage:** `node create-activities.js`

### 3. Post-Processing Scripts

These scripts refine the generated import sheets and prepare for the final API step.

#### `map-snotes.js`
* **Purpose:** Reads the CSVs generated by the "create notes" scripts and replaces the Salesforce "Association ID" with the correct HubSpot "Record ID" from your mapper files.
* **Configuration:** Set the directory paths for your mappers and the note CSVs.
* **Usage:** `node map-snotes.js`
* **Output:** Generates new files ending in `_mapped.csv`. **These are the files you will use for the HubSpot Note import.**

#### `create-import-manifest.js`
* **Purpose:** The final data preparation step. It reads your mapper files and your Salesforce `Attachment` and `ContentVersion` CSVs to produce a set of JSON "manifest" files. These files link a HubSpot record ID to the specific file(s) that should be attached to it.
* **Configuration:** Requires paths to all mappers, all relevant Salesforce CSVs, and the folders containing the renamed files.
* **Usage:** `node create-import-manifest.js`
* **Output:** Creates `contacts_manifest.json`, `companies_manifest.json`, etc.

### 4. HubSpot API Upload Script

#### `import-files.js`
* **Purpose:** Reads the JSON manifest files and performs the final import. For each entry, it finds the file on your disk, uploads it to the HubSpot File Manager, and then attaches it as a Note engagement to the specified HubSpot record.
* **Special Setup:** This script requires API credentials.
    1.  **Create a `.env` file** in the project root.
    2.  Add your HubSpot Private App token to it: `HUBSPOT_API_KEY=your-private-app-token-goes-here`
    3.  **Add `.env` to your `.gitignore` file** to keep your key secure.
* **Configuration:** The `DRY_RUN` flag is at the top. **It is highly recommended to run with `DRY_RUN: true` first.** This will simulate the entire process and log which files it finds without making any changes to your HubSpot account. Once you confirm the output is correct, set it to `false` to perform the live import.
* **Usage:** `node import-files.js`
